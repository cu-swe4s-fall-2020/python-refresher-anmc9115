test -e ssshtest || wget -q https://raw.githubusercontent.com/ryanlayer/ssshtest/master/ssshtest
. ssshtest

# Test correct input
run test_get_daily_rates_CO python get_daily_rates.py --state Colorado --date 2020-07-23
assert_exit_code 0
assert_in_stdout "Adams 0.012028903789149984
Alamosa 0.013985108449336354
Arapahoe 0.010971970426728532
Archuleta 0.0019860973187686196
Baca 0.003695881731784583
Bent 0.0007693491306354824
Boulder 0.0058254998014034155
Broomfield 0.006673942994149117
Chaffee 0.012353304508956145
Cheyenne 0.003812636165577342
Clear Creek 0.002640845070422535
Conejos 0.002543604651162791
Costilla 0.006242905788876277
Crowley 0.012364760432766615
Custer 0.0023501762632197414
Delta 0.003004652364952184
Denver 0.014677801512268437
Dolores 0.0009689922480620155
Douglas 0.0050198798451649065
Eagle 0.01729984481866774
El Paso 0.006330120865293293
Elbert 0.0032920384648704843
Fremont 0.001772595250298992
Garfield 0.010197024242316765
Gilpin 0.0023892666789193163
Grand 0.0026275011790069394
Gunnison 0.014095536413469069
Hinsdale 0.0035587188612099642
Huerfano 0.000894054537326777
Jackson 0.005738880918220947
Jefferson 0.006476560351552634
Kit Carson 0.004957678355501814
La Plata 0.0035064479682082052
Lake 0.008344733242134063
Larimer 0.003948202783432901
Las Animas 0.0008383310762881279
Lincoln 0.001097494055240534
Logan 0.028314765071117177
Mesa 0.0014517151366861365
Mineral 0.023876404494382022
Moffat 0.0014498006524102935
Montezuma 0.003602897983160368
Montrose 0.006008334140905127
Morgan 0.023651408075570864
Otero 0.0017524295045403856
Ouray 0.002705139765554554
Park 0.0022213994816734544
Phillips 0.004277352543899144
Pitkin 0.00874737578726382
Prowers 0.0035853716835311925
Pueblo 0.003382307639111547
Rio Blanco 0.0009000900090009
Rio Grande 0.007010515773660491
Routt 0.003998468671572589
Saguache 0.017354289456450556
San Juan 0.002861230329041488
San Miguel 0.009512161978529691
Sedgwick 0.004623791509037411
Summit 0.011145245409730657
Teller 0.003811563169164882
Washington 0.009555463232239303
Weld 0.013230495401957877
Yuma 0.005576023100667131"

# Test other correct input
run test_get_daily_rates_WA python get_daily_rates.py --state Washington --date 2020-07-23
assert_exit_code 0
assert_in_stdout "Adams 0.01719350704826997
Asotin 0.00101743513850992
Benton 0.018193027623489386
Chelan 0.011552316674257795
Clallam 0.0009803372360091872
Clark 0.0037732477907105226
Columbia 0.0024521824423737125
Cowlitz 0.003691045796308954
Douglas 0.015118003694933777
Ferry 0.00092702953251225
Franklin 0.03893146373603879
Garfield 0.00088261253309797
Grant 0.01209605026929982
Grays Harbor 0.00096157808700908
Island 0.00281507145950628
Jefferson 0.0016738082485270487
King 0.007164793353938307
Kitsap 0.0017600235731664098
Kittitas 0.007478919711597214
Klickitat 0.0041834826262427405
Lewis 0.0018156517129414883
Lincoln 0.0006622516556291391
Mason 0.0014662515033196594
Okanogan 0.012743190661478599
Pacific 0.0012906309751434034
Pend Oreille 0.0021536804861164525
Pierce 0.005765663805841114
San Juan 0.0015853890544739679
Skagit 0.006184720404444787
Skamania 0.003976143141153081
Snohomish 0.007260263410599508
Spokane 0.006531966953934566
Stevens 0.0011486067400243505
Thurston 0.0021049376843307013
Wahkiakum 0.0015082956259426848
Walla Walla 0.005477960565488848
Whatcom 0.004066819130953565
Whitman 0.0016526710737895301
Yakima 0.040517039357647666"

# test for error raised when county name is wrong
run test_typo_county python get_daily_rates.py --state Colorado --date 2020-07-23
assert_exit_code 0